import re

# --- 1. إعدادات البوت والقناة ---
# التوكن الخاص بك (يفضل دائماً وضعه في Environment Variables في Render)
BOT_TOKEN = "8498451295:AAGt1R7THllSjYtEe5hvIEPnPhRkS_iBcnU"

# --- 2. إعدادات الأحياء (المدينة المنورة) ---
# تم ترتيبها وتنظيفها لضمان مطابقة أدق
CITIES_DISTRICTS = {
    "المدينة المنورة": [
        "أبو مرخة", "أبيار علي", "الأسواف", "البخاري", "الإسكان", "البحر", 
        "البدراني", "الجمعة", "الجرف", "الحزام", "الحمراء", "الخاتم", "الخالدية", 
        "الدائرة", "الدائري", "الدويخله", "الدويمة", "الدعيثة", "الرانونا", "الرناونة", 
        "الربوة", "السيح", "الشروق", "الشرق", "الشهداء", "الشيبية", "الظاهرة", 
        "العاقول", "العالية", "العوالي", "العريض", "العزيزية", "العصبة", 
        "العنابس", "العنبرية", "العيون", "الفتح", "القبلتين", "القارات", "المبعوث", 
        "المطار", "المغيسله", "الملك فهد", "الملك فيصل", "المناخة", "المصانع", 
        "النور مول", "النبلاء", "النقيع", "النقمي", "الهجرة", "الواحة", "الوادي", 
        "بئر الماشي", "بئر عثمان", "باقدو", "بني حارثة", "بني ظفر", "تلال علي", 
        "جامعة طيبة", "الجامعة الإسلامية", "حمراء الأسد", 
        "دفاع", "ذو الحليفة", "رهط", "سيد الشهداء", "سلطانة", "سكة الحديد", 
        "السقيا", "شظاة", "شوران", "عروة", "قباء", "قربان", "محطة القطار", 
        "مخطط التلال", "المستشفى الألماني", "الحرس الوطني", "مستشفى الملك سلمان", 
        "مستشفى الملك فهد", "المواساة", "الولادة", "ممشى الهجرة", 
        "منار مول", "مهزور", "وعيرة"
    ]
}

# --- 3. معالجة النصوص (الذكاء اللغوي) ---

def normalize_text(text):
    """تنظيف وتوحيد النصوص العربية لزيادة دقة البحث عن الأحياء والطلبات"""
    if not text: return ""
    
    # 1. تحويل للصغير وإزالة المسافات الزائدة
    text = text.strip().lower()
    
    # 2. إزالة التشكيل (فتحة، ضمة، إلخ)
    text = re.sub(r"[\u064B-\u0652]", "", text)
    
    # 3. توحيد الحروف المتشابهة
    replacements = {
        "أ": "ا", "إ": "ا", "آ": "ا",
        "ة": "ه", "ى": "ي", "ئ": "ي", "ؤ": "و"
    }
    for old, new in replacements.items():
        text = text.replace(old, new)

    # 4. إزالة تكرار الحروف (مشوااااار -> مشوار)
    text = re.sub(r'(.)\1+', r'\1', text)

    # 5. معالجة الـ التعريف لزيادة مرونة البحث
    # نقوم بإزالة "ال" إذا كانت تجعل الكلمة أكثر من 3 حروف (مثل العزيزية -> عزيزيه)
    words = text.split()
    clean_words = []
    for w in words:
        if w.startswith("ال") and len(w) > 3:
            clean_words.append(w[2:])
        else:
            clean_words.append(w)

    return " ".join(clean_words)
